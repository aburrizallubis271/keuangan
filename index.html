<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keuangan Keluarga Mobile</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.5;
            padding: 0;
            font-size: 14px;
            min-height: 100vh;
            padding-bottom: 70px; /* Untuk bottom nav */
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            padding: 20px 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .header-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .current-date {
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 20px;
            margin-top: 8px;
            display: inline-block;
        }
        
        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 15px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid;
        }
        
        .stat-card.income {
            border-left-color: #10b981;
        }
        
        .stat-card.expense {
            border-left-color: #ef4444;
        }
        
        .stat-card.savings {
            border-left-color: #3b82f6;
        }
        
        .stat-card.balance {
            border-left-color: #8b5cf6;
            grid-column: span 2;
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .stat-title {
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 600;
        }
        
        .stat-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        
        .income .stat-icon {
            background-color: #d1fae5;
            color: #10b981;
        }
        
        .expense .stat-icon {
            background-color: #fee2e2;
            color: #ef4444;
        }
        
        .savings .stat-icon {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        
        .balance .stat-icon {
            background-color: #ede9fe;
            color: #8b5cf6;
        }
        
        .stat-amount {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .stat-change {
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .positive {
            color: #10b981;
        }
        
        .negative {
            color: #ef4444;
        }
        
        /* Tabs Navigation */
        .tabs-container {
            background: white;
            margin: 0 15px 15px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .tabs-header {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .tabs-header::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 14px 10px;
            border: none;
            background: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: white;
        }
        
        /* Tab Content */
        .tab-content {
            display: block;
        }
        
        .tab-content.hidden {
            display: none;
        }
        
        /* Transaction Form */
        .transaction-form {
            padding: 20px;
            background: white;
            margin: 0 15px 15px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.1rem;
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            color: #3b82f6;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #475569;
            font-size: 0.9rem;
        }
        
        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.2s;
            background: white;
        }
        
        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #64748b;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #475569;
        }
        
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        
        .btn-warning {
            background-color: #f59e0b;
            color: white;
        }
        
        /* Month Selector */
        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px;
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .month-nav {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f1f5f9;
            border: none;
            font-size: 1.1rem;
            color: #475569;
            cursor: pointer;
        }
        
        .month-display {
            font-weight: 600;
            color: #1e293b;
            font-size: 1rem;
            text-align: center;
            flex: 1;
        }
        
        /* Transactions List */
        .transactions-container {
            margin: 0 15px 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .transactions-header {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .transaction-item {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }
        
        .transaction-type {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .type-income {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .type-expense {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .type-savings-add {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .type-savings-withdraw {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .transaction-date {
            font-size: 0.8rem;
            color: #64748b;
        }
        
        .transaction-description {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }
        
        .transaction-category {
            font-size: 0.85rem;
            color: #64748b;
        }
        
        .transaction-amount {
            font-weight: 700;
            font-size: 1.1rem;
            text-align: right;
            min-width: 100px;
        }
        
        .transaction-notes {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-top: 4px;
            font-style: italic;
        }
        
        .transaction-actions {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }
        
        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .edit-btn {
            color: #3b82f6;
            background-color: #dbeafe;
        }
        
        .delete-btn {
            color: #ef4444;
            background-color: #fee2e2;
        }
        
        /* Charts & Reports */
        .charts-container {
            margin: 0 15px 15px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .chart-placeholder {
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            text-align: center;
            padding: 20px;
        }
        
        .chart-placeholder i {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        /* Reports Section */
        .reports-section {
            padding: 15px;
        }
        
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .report-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .report-card:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        .report-card i {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #3b82f6;
        }
        
        .report-card h4 {
            font-size: 0.95rem;
            color: #1e293b;
            margin-bottom: 5px;
        }
        
        .report-card p {
            font-size: 0.8rem;
            color: #64748b;
            line-height: 1.3;
        }
        
        /* Yearly Summary */
        .yearly-summary {
            margin: 0 15px 15px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .yearly-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .year-selector {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            background: white;
            font-weight: 600;
            color: #334155;
        }
        
        .yearly-table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .yearly-table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
        }
        
        .yearly-table th, .yearly-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.85rem;
        }
        
        .yearly-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #475569;
            position: sticky;
            left: 0;
        }
        
        .year-total {
            font-weight: 700;
            background-color: #f1f5f9;
        }
        
        /* Settings */
        .settings-section {
            padding: 20px;
        }
        
        .setting-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .modal-title {
            font-size: 1.2rem;
            color: #1e293b;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #64748b;
            font-size: 0.8rem;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
            border: none;
            background: none;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: #3b82f6;
            background: #dbeafe;
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        /* Loading Indicator */
        .loading {
            text-align: center;
            padding: 20px;
            color: #64748b;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Utility Classes */
        .rupiah {
            font-family: 'Courier New', monospace;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-15 {
            margin-bottom: 15px;
        }
        
        .mt-15 {
            margin-top: 15px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            body {
                max-width: 768px;
                margin: 0 auto;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .stat-card.balance {
                grid-column: span 1;
            }
            
            .reports-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 360px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .reports-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-title">
            <h1><i class="fas fa-wallet"></i> Keuangan Keluarga</h1>
            <button class="btn btn-secondary" onclick="toggleTheme()" style="padding: 8px; font-size: 0.8rem;">
                <i class="fas fa-moon"></i>
            </button>
        </div>
        <p class="header-subtitle">Kelola keuangan keluarga dengan mudah</p>
        <div class="current-date" id="current-date">Muat tanggal...</div>
    </header>
    
    <!-- Dashboard Stats -->
    <div class="stats-grid">
        <div class="stat-card income">
            <div class="stat-header">
                <div class="stat-title">Pemasukan</div>
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
            </div>
            <div class="stat-amount rupiah" id="total-income">Rp 0</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>Bulan ini</span>
            </div>
        </div>
        
        <div class="stat-card expense">
            <div class="stat-header">
                <div class="stat-title">Pengeluaran</div>
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
            </div>
            <div class="stat-amount rupiah" id="total-expense">Rp 0</div>
            <div class="stat-change negative">
                <i class="fas fa-arrow-down"></i>
                <span>Bulan ini</span>
            </div>
        </div>
        
        <div class="stat-card savings">
            <div class="stat-header">
                <div class="stat-title">Tabungan</div>
                <div class="stat-icon">
                    <i class="fas fa-piggy-bank"></i>
                </div>
            </div>
            <div class="stat-amount rupiah" id="total-savings">Rp 0</div>
            <div class="stat-change positive">
                <i class="fas fa-piggy-bank"></i>
                <span>Total</span>
            </div>
        </div>
        
        <div class="stat-card balance">
            <div class="stat-header">
                <div class="stat-title">Saldo Bulan Ini</div>
                <div class="stat-icon">
                    <i class="fas fa-balance-scale"></i>
                </div>
            </div>
            <div class="stat-amount rupiah" id="current-balance">Rp 0</div>
            <div class="stat-change" id="balance-change">
                <i class="fas fa-minus"></i>
                <span>Bersih bulan ini</span>
            </div>
        </div>
    </div>
    
    <!-- Tabs Navigation -->
    <div class="tabs-container">
        <div class="tabs-header">
            <button class="tab-btn active" data-tab="transactions">
                <i class="fas fa-exchange-alt"></i> Transaksi
            </button>
            <button class="tab-btn" data-tab="reports">
                <i class="fas fa-chart-bar"></i> Laporan
            </button>
            <button class="tab-btn" data-tab="summary">
                <i class="fas fa-calendar-alt"></i> Tahunan
            </button>
            <button class="tab-btn" data-tab="settings">
                <i class="fas fa-cog"></i> Pengaturan
            </button>
        </div>
        
        <!-- Transactions Tab -->
        <div id="transactions-tab" class="tab-content">
            <!-- Month Selector -->
            <div class="month-selector">
                <button class="month-nav" id="prev-month">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="month-display" id="current-month-year">Januari 2023</div>
                <button class="month-nav" id="next-month">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- Transaction Form -->
            <div class="transaction-form">
                <h3 class="section-title">
                    <i class="fas fa-plus-circle"></i> Tambah Transaksi
                </h3>
                
                <form id="transaction-form">
                    <input type="hidden" id="transaction-id" value="">
                    
                    <div class="form-group">
                        <label for="transaction-type">Jenis Transaksi</label>
                        <select id="transaction-type" required>
                            <option value="">Pilih Jenis</option>
                            <option value="income">Pemasukan</option>
                            <option value="expense">Pengeluaran</option>
                            <option value="savings-add">Tambah Tabungan</option>
                            <option value="savings-withdraw">Kurangi Tabungan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="transaction-description">Keterangan *</label>
                        <input type="text" id="transaction-description" 
                               placeholder="Contoh: Gaji bulan Januari" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="transaction-amount">Jumlah (Rp) *</label>
                            <input type="number" id="transaction-amount" 
                                   min="1" placeholder="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="transaction-date">Tanggal *</label>
                            <input type="date" id="transaction-date" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="transaction-category">Kategori *</label>
                        <select id="transaction-category" required>
                            <!-- Options akan diisi oleh JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="transaction-notes">Catatan (Opsional)</label>
                        <textarea id="transaction-notes" rows="2" 
                                  placeholder="Tambahkan catatan jika perlu..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                        <button type="button" class="btn btn-secondary" id="reset-form">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Transactions List -->
            <div class="transactions-container">
                <div class="transactions-header">
                    <h3 class="section-title" style="margin: 0;">
                        <i class="fas fa-history"></i> Riwayat Transaksi
                    </h3>
                    <span id="transactions-count">0 transaksi</span>
                </div>
                
                <div class="transactions-list" id="transactions-list">
                    <div class="loading" id="transactions-loading">
                        <i class="fas fa-spinner fa-spin"></i> Memuat transaksi...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content hidden">
            <!-- Chart Section -->
            <div class="charts-container">
                <h3 class="section-title">
                    <i class="fas fa-chart-pie"></i> Grafik Pengeluaran
                </h3>
                
                <div class="chart-placeholder" id="chart-placeholder">
                    <i class="fas fa-chart-pie"></i>
                    <p>Tidak ada data pengeluaran bulan ini</p>
                </div>
                <canvas id="expense-chart" style="display: none;"></canvas>
            </div>
            
            <!-- Reports Section -->
            <div class="reports-section">
                <h3 class="section-title">
                    <i class="fas fa-file-download"></i> Unduh Laporan
                </h3>
                
                <div class="reports-grid">
                    <div class="report-card" id="download-monthly-report">
                        <i class="fas fa-file-pdf"></i>
                        <h4>Laporan Bulanan</h4>
                        <p>Detail transaksi bulan ini</p>
                    </div>
                    
                    <div class="report-card" id="download-yearly-report">
                        <i class="fas fa-file-alt"></i>
                        <h4>Laporan Tahunan</h4>
                        <p>Rekap Januari-Desember</p>
                    </div>
                    
                    <div class="report-card" id="backup-data">
                        <i class="fas fa-database"></i>
                        <h4>Backup Data</h4>
                        <p>Simpan ke file JSON</p>
                    </div>
                    
                    <div class="report-card" id="restore-data">
                        <i class="fas fa-upload"></i>
                        <h4>Restore Data</h4>
                        <p>Muat dari backup</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Yearly Summary Tab -->
        <div id="summary-tab" class="tab-content hidden">
            <div class="yearly-summary">
                <div class="yearly-header">
                    <h3 class="section-title" style="margin: 0;">
                        <i class="fas fa-calendar-alt"></i> Rekapan Tahunan
                    </h3>
                    <select class="year-selector" id="year-selector">
                        <!-- Options akan diisi oleh JavaScript -->
                    </select>
                </div>
                
                <div class="yearly-table-container">
                    <table class="yearly-table">
                        <thead>
                            <tr>
                                <th>Bulan</th>
                                <th>Pemasukan</th>
                                <th>Pengeluaran</th>
                                <th>Tabungan</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="yearly-summary-body">
                            <!-- Data akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="no-yearly-data" style="display: none;">
                    <i class="fas fa-calendar-times"></i>
                    <p>Belum ada data untuk tahun ini</p>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content hidden">
            <div class="settings-section">
                <h3 class="section-title">
                    <i class="fas fa-cog"></i> Pengaturan Aplikasi
                </h3>
                
                <div class="setting-item">
                    <h4>Mode Tampilan</h4>
                    <p>Ubah antara mode terang dan gelap</p>
                    <div class="form-actions">
                        <button class="btn" onclick="toggleTheme()">
                            <i class="fas fa-moon"></i> Mode Gelap
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <h4>Kelola Data</h4>
                    <p>Ekspor, impor, atau hapus data keuangan</p>
                    <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="exportData()">
                            <i class="fas fa-download"></i> Ekspor
                        </button>
                        <button class="btn btn-warning" onclick="importData()">
                            <i class="fas fa-upload"></i> Impor
                        </button>
                        <button class="btn btn-danger" onclick="clearAllData()">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <h4>Tentang Aplikasi</h4>
                    <p><strong>Keuangan Keluarga v1.0</strong></p>
                    <p>Aplikasi untuk mengelola keuangan keluarga secara mudah dan praktis.</p>
                    <p style="margin-top: 10px; font-size: 0.85rem; color: #64748b;">
                        Data tersimpan secara lokal di browser Anda.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-item active" data-tab="transactions">
            <i class="fas fa-home"></i>
            <span>Beranda</span>
        </button>
        <button class="nav-item" data-tab="reports">
            <i class="fas fa-chart-bar"></i>
            <span>Laporan</span>
        </button>
        <button class="nav-item" data-tab="summary">
            <i class="fas fa-calendar-alt"></i>
            <span>Tahunan</span>
        </button>
        <button class="nav-item" data-tab="settings">
            <i class="fas fa-cog"></i>
            <span>Pengaturan</span>
        </button>
    </div>
    
    <!-- Restore Data Modal -->
    <div class="modal" id="restore-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Restore Data</h3>
                <button class="close-modal">&times;</button>
            </div>
            <p>Pilih file backup data keuangan (format JSON):</p>
            <input type="file" id="restore-file" accept=".json" class="form-group" style="margin-top: 15px;">
            <div class="form-actions" style="margin-top: 20px;">
                <button class="btn btn-primary" id="confirm-restore">
                    <i class="fas fa-upload"></i> Restore
                </button>
                <button class="btn btn-secondary" id="cancel-restore">
                    <i class="fas fa-times"></i> Batal
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let transactions = JSON.parse(localStorage.getItem('familyFinanceTransactions')) || [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let expenseChart = null;
        
        // Transaction categories
        const categories = {
            income: ["Gaji", "Bonus", "Investasi", "Hadiah", "Lainnya"],
            expense: ["Makanan", "Transportasi", "Belanja", "Hiburan", "Pendidikan", "Kesehatan", "Tagihan", "Utilitas", "Lainnya"],
            "savings-add": ["Tabungan Rutin", "Investasi", "Darurat", "Lainnya"],
            "savings-withdraw": ["Kebutuhan Mendesak", "Investasi", "Kesehatan", "Lainnya"]
        };
        
        // Month names in Indonesian
        const monthNames = [
            "Januari", "Februari", "Maret", "April", "Mei", "Juni",
            "Juli", "Agustus", "September", "Oktober", "November", "Desember"
        ];
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            updateCurrentDate();
            
            // Initialize UI components
            initializeUI();
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Load and display data
            loadData();
            
            // Update display
            updateDashboard();
            renderTransactions();
            updateMonthYearDisplay();
        });
        
        // Update current date display
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = now.toLocaleDateString('id-ID', options);
            document.getElementById('current-date').textContent = formattedDate;
        }
        
        // Initialize UI components
        function initializeUI() {
            // Set default date to today
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('transaction-date').value = formattedDate;
            
            // Initialize category dropdown
            updateCategoryDropdown('income');
            
            // Initialize year selector
            initializeYearSelector();
            
            // Hide loading indicator
            document.getElementById('transactions-loading').style.display = 'none';
        }
        
        // Update category dropdown based on transaction type
        function updateCategoryDropdown(type) {
            const categorySelect = document.getElementById('transaction-category');
            categorySelect.innerHTML = '<option value="">Pilih Kategori</option>';
            
            if (categories[type]) {
                categories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
        }
        
        // Initialize year selector
        function initializeYearSelector() {
            const yearSelect = document.getElementById('year-selector');
            yearSelect.innerHTML = '';
            
            // Add current year and previous 3 years
            for (let i = currentYear; i >= currentYear - 3; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                if (i === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
        }
        
        // Update month/year display
        function updateMonthYearDisplay() {
            const display = document.getElementById('current-month-year');
            display.textContent = `${monthNames[currentMonth]} ${currentYear}`;
        }
        
        // Initialize event listeners
        function initializeEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn, .nav-item').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.dataset.tab;
                    
                    // Update active tab button
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update active nav item
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
                    
                    // Show corresponding tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${tabId}-tab`).classList.remove('hidden');
                });
            });
            
            // Transaction type change
            document.getElementById('transaction-type').addEventListener('change', function() {
                updateCategoryDropdown(this.value);
            });
            
            // Transaction form submission
            document.getElementById('transaction-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveTransaction();
            });
            
            // Reset form button
            document.getElementById('reset-form').addEventListener('click', function() {
                resetTransactionForm();
            });
            
            // Month navigation
            document.getElementById('prev-month').addEventListener('click', function() {
                navigateMonth(-1);
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                navigateMonth(1);
            });
            
            // Year selector change
            document.getElementById('year-selector').addEventListener('change', function() {
                renderYearlySummary();
            });
            
            // Report buttons
            document.getElementById('download-monthly-report').addEventListener('click', function() {
                downloadMonthlyReport();
            });
            
            document.getElementById('download-yearly-report').addEventListener('click', function() {
                downloadYearlyReport();
            });
            
            document.getElementById('backup-data').addEventListener('click', function() {
                backupData();
            });
            
            document.getElementById('restore-data').addEventListener('click', function() {
                document.getElementById('restore-modal').style.display = 'flex';
            });
            
            // Restore modal buttons
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('restore-modal').style.display = 'none';
            });
            
            document.getElementById('cancel-restore').addEventListener('click', function() {
                document.getElementById('restore-modal').style.display = 'none';
            });
            
            document.getElementById('confirm-restore').addEventListener('click', function() {
                restoreData();
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('restore-modal')) {
                    document.getElementById('restore-modal').style.display = 'none';
                }
            });
        }
        
        // Navigate to previous/next month
        function navigateMonth(direction) {
            currentMonth += direction;
            
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            
            // Update display
            updateMonthYearDisplay();
            updateDashboard();
            renderTransactions();
        }
        
        // Save transaction
        function saveTransaction() {
            const id = document.getElementById('transaction-id').value;
            const type = document.getElementById('transaction-type').value;
            const description = document.getElementById('transaction-description').value.trim();
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const category = document.getElementById('transaction-category').value;
            const date = document.getElementById('transaction-date').value;
            const notes = document.getElementById('transaction-notes').value.trim();
            
            // Validate input
            if (!type || !description || !amount || amount <= 0 || !category || !date) {
                alert('Harap isi semua field dengan benar! Jumlah harus lebih dari 0.');
                return;
            }
            
            // Create transaction object
            const transaction = {
                id: id || Date.now(),
                type,
                description,
                amount,
                category,
                date,
                notes,
                createdAt: new Date().toISOString()
            };
            
            // Add or update transaction
            if (id) {
                // Update existing transaction
                const index = transactions.findIndex(t => t.id == id);
                if (index !== -1) {
                    transactions[index] = transaction;
                }
            } else {
                // Add new transaction
                transactions.push(transaction);
            }
            
            // Save to localStorage
            saveData();
            
            // Update UI
            resetTransactionForm();
            updateDashboard();
            renderTransactions();
            renderYearlySummary();
            
            // Show success message
            alert(`Transaksi berhasil ${id ? 'diperbarui' : 'disimpan'}!`);
            
            // Switch to transactions tab
            document.querySelector('.tab-btn[data-tab="transactions"]').click();
        }
        
        // Edit transaction
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id == id);
            if (!transaction) return;
            
            // Fill form with transaction data
            document.getElementById('transaction-id').value = transaction.id;
            document.getElementById('transaction-type').value = transaction.type;
            document.getElementById('transaction-description').value = transaction.description;
            document.getElementById('transaction-amount').value = transaction.amount;
            document.getElementById('transaction-date').value = transaction.date;
            document.getElementById('transaction-notes').value = transaction.notes || '';
            
            // Update category dropdown
            updateCategoryDropdown(transaction.type);
            setTimeout(() => {
                document.getElementById('transaction-category').value = transaction.category;
            }, 100);
            
            // Scroll to form
            document.getElementById('transaction-form').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Delete transaction
        function deleteTransaction(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) return;
            
            transactions = transactions.filter(t => t.id != id);
            saveData();
            updateDashboard();
            renderTransactions();
            renderYearlySummary();
            
            alert('Transaksi berhasil dihapus!');
        }
        
        // Reset transaction form
        function resetTransactionForm() {
            document.getElementById('transaction-form').reset();
            document.getElementById('transaction-id').value = '';
            
            // Set default date to today
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('transaction-date').value = formattedDate;
            
            // Reset to default values
            document.getElementById('transaction-type').value = '';
            updateCategoryDropdown('income');
        }
        
        // Update dashboard
        function updateDashboard() {
            // Filter transactions for current month and year
            const monthTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && 
                       transactionDate.getFullYear() === currentYear;
            });
            
            // Calculate totals
            const totalIncome = monthTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = monthTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const savingsAdd = monthTransactions
                .filter(t => t.type === 'savings-add')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const savingsWithdraw = monthTransactions
                .filter(t => t.type === 'savings-withdraw')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const netSavings = savingsAdd - savingsWithdraw;
            const currentBalance = totalIncome - totalExpense - netSavings;
            
            // Calculate total savings (all time)
            const allSavingsAdd = transactions
                .filter(t => t.type === 'savings-add')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const allSavingsWithdraw = transactions
                .filter(t => t.type === 'savings-withdraw')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalSavings = allSavingsAdd - allSavingsWithdraw;
            
            // Update dashboard display
            document.getElementById('total-income').textContent = formatRupiah(totalIncome);
            document.getElementById('total-expense').textContent = formatRupiah(totalExpense);
            document.getElementById('total-savings').textContent = formatRupiah(totalSavings);
            document.getElementById('current-balance').textContent = formatRupiah(currentBalance);
            
            // Update balance change indicator
            const balanceChange = document.getElementById('balance-change');
            if (currentBalance >= 0) {
                balanceChange.className = 'stat-change positive';
                balanceChange.innerHTML = '<i class="fas fa-arrow-up"></i><span>Positif</span>';
            } else {
                balanceChange.className = 'stat-change negative';
                balanceChange.innerHTML = '<i class="fas fa-arrow-down"></i><span>Negatif</span>';
            }
            
            // Update expense chart
            updateExpenseChart(monthTransactions);
        }
        
        // Update expense chart
        function updateExpenseChart(monthTransactions) {
            const expenseTransactions = monthTransactions.filter(t => t.type === 'expense');
            
            if (expenseTransactions.length === 0) {
                document.getElementById('chart-placeholder').style.display = 'flex';
                document.getElementById('expense-chart').style.display = 'none';
                if (expenseChart) {
                    expenseChart.destroy();
                    expenseChart = null;
                }
                return;
            }
            
            // Group expenses by category
            const expensesByCategory = {};
            expenseTransactions.forEach(t => {
                if (expensesByCategory[t.category]) {
                    expensesByCategory[t.category] += t.amount;
                } else {
                    expensesByCategory[t.category] = t.amount;
                }
            });
            
            // Prepare data for chart
            const categories = Object.keys(expensesByCategory);
            const amounts = Object.values(expensesByCategory);
            
            // Get chart canvas
            const chartCanvas = document.getElementById('expense-chart');
            document.getElementById('chart-placeholder').style.display = 'none';
            chartCanvas.style.display = 'block';
            
            // Destroy existing chart if exists
            if (expenseChart) {
                expenseChart.destroy();
            }
            
            // Create new chart
            const ctx = chartCanvas.getContext('2d');
            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: amounts,
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                            '#9966FF', '#FF9F40', '#8AC926', '#1982C4',
                            '#FF595E', '#6A0572'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Render transactions list
        function renderTransactions() {
            const container = document.getElementById('transactions-list');
            
            // Filter transactions for selected month and year
            const filteredTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && 
                       transactionDate.getFullYear() === currentYear;
            });
            
            // Sort by date (newest first)
            filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Update transactions count
            document.getElementById('transactions-count').textContent = `${filteredTransactions.length} transaksi`;
            
            // Clear container
            container.innerHTML = '';
            
            // Display "no transactions" message if empty
            if (filteredTransactions.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-receipt"></i>
                    <p>Tidak ada transaksi untuk bulan ini</p>
                `;
                container.appendChild(emptyState);
                return;
            }
            
            // Render each transaction
            filteredTransactions.forEach(transaction => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                
                // Format date
                const date = new Date(transaction.date);
                const formattedDate = date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: 'short'
                });
                
                // Determine type class and label
                let typeClass = '';
                let typeLabel = '';
                
                switch(transaction.type) {
                    case 'income':
                        typeClass = 'type-income';
                        typeLabel = 'Pemasukan';
                        break;
                    case 'expense':
                        typeClass = 'type-expense';
                        typeLabel = 'Pengeluaran';
                        break;
                    case 'savings-add':
                        typeClass = 'type-savings-add';
                        typeLabel = 'Tambah Tabungan';
                        break;
                    case 'savings-withdraw':
                        typeClass = 'type-savings-withdraw';
                        typeLabel = 'Kurangi Tabungan';
                        break;
                }
                
                item.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-header">
                            <span class="transaction-type ${typeClass}">${typeLabel}</span>
                            <span class="transaction-date">${formattedDate}</span>
                        </div>
                        <div class="transaction-description">${transaction.description}</div>
                        <div class="transaction-category">${transaction.category}</div>
                        ${transaction.notes ? `<div class="transaction-notes">${transaction.notes}</div>` : ''}
                        <div class="transaction-actions">
                            <button class="action-btn edit-btn" onclick="editTransaction(${transaction.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteTransaction(${transaction.id})" title="Hapus">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="transaction-amount rupiah">${formatRupiah(transaction.amount)}</div>
                `;
                
                container.appendChild(item);
            });
        }
        
        // Render yearly summary
        function renderYearlySummary() {
            const tbody = document.getElementById('yearly-summary-body');
            const year = parseInt(document.getElementById('year-selector').value);
            
            // Clear table
            tbody.innerHTML = '';
            
            // Check if there's data for this year
            const yearTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getFullYear() === year;
            });
            
            if (yearTransactions.length === 0) {
                document.getElementById('no-yearly-data').style.display = 'block';
                return;
            } else {
                document.getElementById('no-yearly-data').style.display = 'none';
            }
            
            // Calculate for each month
            for (let month = 0; month < 12; month++) {
                // Filter transactions for this month
                const monthTransactions = yearTransactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate.getMonth() === month;
                });
                
                // Calculate monthly totals
                const monthlyIncome = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlyExpense = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlySavingsAdd = monthTransactions
                    .filter(t => t.type === 'savings-add')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlySavingsWithdraw = monthTransactions
                    .filter(t => t.type === 'savings-withdraw')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlyNetSavings = monthlySavingsAdd - monthlySavingsWithdraw;
                const monthlyBalance = monthlyIncome - monthlyExpense - monthlyNetSavings;
                
                // Create row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${monthNames[month].substring(0, 3)}</strong></td>
                    <td class="rupiah">${formatRupiah(monthlyIncome)}</td>
                    <td class="rupiah">${formatRupiah(monthlyExpense)}</td>
                    <td class="rupiah">${formatRupiah(monthlyNetSavings)}</td>
                    <td class="rupiah">${formatRupiah(monthlyBalance)}</td>
                `;
                
                tbody.appendChild(row);
            }
        }
        
        // Download monthly report
        function downloadMonthlyReport() {
            // Filter transactions for current month
            const monthTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && 
                       transactionDate.getFullYear() === currentYear;
            });
            
            if (monthTransactions.length === 0) {
                alert('Tidak ada data transaksi untuk bulan ini.');
                return;
            }
            
            // Create printable content
            const monthName = monthNames[currentMonth];
            const year = currentYear;
            
            let reportContent = `
                <html>
                <head>
                    <title>Laporan Keuangan ${monthName} ${year}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1, h2 { text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .summary { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 5px; }
                        .rupiah { font-family: 'Courier New', monospace; }
                    </style>
                </head>
                <body>
                    <h1>Laporan Keuangan Bulanan</h1>
                    <h2>${monthName} ${year}</h2>
                    <hr>
            `;
            
            // Calculate summary
            const totalIncome = monthTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = monthTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const savingsAdd = monthTransactions
                .filter(t => t.type === 'savings-add')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const savingsWithdraw = monthTransactions
                .filter(t => t.type === 'savings-withdraw')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const netSavings = savingsAdd - savingsWithdraw;
            const balance = totalIncome - totalExpense - netSavings;
            
            reportContent += `
                <div class="summary">
                    <h3>Ringkasan</h3>
                    <p><strong>Total Pemasukan:</strong> ${formatRupiah(totalIncome)}</p>
                    <p><strong>Total Pengeluaran:</strong> ${formatRupiah(totalExpense)}</p>
                    <p><strong>Tabungan (Bersih):</strong> ${formatRupiah(netSavings)}</p>
                    <p><strong>Saldo Akhir Bulan:</strong> ${formatRupiah(balance)}</p>
                </div>
                
                <h3>Detail Transaksi</h3>
                <table>
                    <tr>
                        <th>Tanggal</th>
                        <th>Keterangan</th>
                        <th>Kategori</th>
                        <th>Jenis</th>
                        <th>Jumlah</th>
                    </tr>
            `;
            
            // Sort transactions by date
            monthTransactions.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Add transactions to table
            monthTransactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const formattedDate = date.toLocaleDateString('id-ID');
                
                let typeLabel = '';
                switch(transaction.type) {
                    case 'income': typeLabel = 'Pemasukan'; break;
                    case 'expense': typeLabel = 'Pengeluaran'; break;
                    case 'savings-add': typeLabel = 'Tambah Tabungan'; break;
                    case 'savings-withdraw': typeLabel = 'Kurangi Tabungan'; break;
                }
                
                reportContent += `
                    <tr>
                        <td>${formattedDate}</td>
                        <td>${transaction.description}</td>
                        <td>${transaction.category}</td>
                        <td>${typeLabel}</td>
                        <td class="rupiah">${formatRupiah(transaction.amount)}</td>
                    </tr>
                `;
            });
            
            reportContent += `
                </table>
                <p style="margin-top: 30px; font-size: 0.9rem; color: #666;">
                    Laporan dibuat pada: ${new Date().toLocaleDateString('id-ID')}
                </p>
                </body>
                </html>
            `;
            
            // Open print dialog
            const printWindow = window.open('', '_blank');
            printWindow.document.write(reportContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Download yearly report
        function downloadYearlyReport() {
            const year = parseInt(document.getElementById('year-selector').value);
            
            // Check if there's data for this year
            const yearTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getFullYear() === year;
            });
            
            if (yearTransactions.length === 0) {
                alert(`Tidak ada data transaksi untuk tahun ${year}.`);
                return;
            }
            
            // Create printable content
            let reportContent = `
                <html>
                <head>
                    <title>Laporan Keuangan Tahunan ${year}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1, h2 { text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                        th { background-color: #f2f2f2; }
                        .total-row { font-weight: bold; background-color: #f9f9f9; }
                        .rupiah { font-family: 'Courier New', monospace; }
                    </style>
                </head>
                <body>
                    <h1>Laporan Keuangan Tahunan</h1>
                    <h2>Tahun ${year}</h2>
                    <hr>
                    
                    <h3>Rekapan Per Bulan</h3>
                    <table>
                        <tr>
                            <th>Bulan</th>
                            <th>Pemasukan</th>
                            <th>Pengeluaran</th>
                            <th>Tabungan (Bersih)</th>
                            <th>Saldo Akhir</th>
                        </tr>
            `;
            
            let yearlyIncome = 0;
            let yearlyExpense = 0;
            let yearlyNetSavings = 0;
            
            // Calculate for each month
            for (let month = 0; month < 12; month++) {
                const monthTransactions = yearTransactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate.getMonth() === month;
                });
                
                const monthlyIncome = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlyExpense = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlySavingsAdd = monthTransactions
                    .filter(t => t.type === 'savings-add')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlySavingsWithdraw = monthTransactions
                    .filter(t => t.type === 'savings-withdraw')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthlyNetSavings = monthlySavingsAdd - monthlySavingsWithdraw;
                const monthlyBalance = monthlyIncome - monthlyExpense - monthlyNetSavings;
                
                // Update yearly totals
                yearlyIncome += monthlyIncome;
                yearlyExpense += monthlyExpense;
                yearlyNetSavings += monthlyNetSavings;
                
                reportContent += `
                    <tr>
                        <td><strong>${monthNames[month]}</strong></td>
                        <td class="rupiah">${formatRupiah(monthlyIncome)}</td>
                        <td class="rupiah">${formatRupiah(monthlyExpense)}</td>
                        <td class="rupiah">${formatRupiah(monthlyNetSavings)}</td>
                        <td class="rupiah">${formatRupiah(monthlyBalance)}</td>
                    </tr>
                `;
            }
            
            // Add total row
            reportContent += `
                <tr class="total-row">
                    <td><strong>TOTAL ${year}</strong></td>
                    <td class="rupiah">${formatRupiah(yearlyIncome)}</td>
                    <td class="rupiah">${formatRupiah(yearlyExpense)}</td>
                    <td class="rupiah">${formatRupiah(yearlyNetSavings)}</td>
                    <td class="rupiah">${formatRupiah(yearlyIncome - yearlyExpense - yearlyNetSavings)}</td>
                </tr>
                </table>
                
                <div style="margin-top: 30px;">
                    <h3>Analisis Keuangan</h3>
                    <p><strong>Total Pemasukan Tahunan:</strong> ${formatRupiah(yearlyIncome)}</p>
                    <p><strong>Total Pengeluaran Tahunan:</strong> ${formatRupiah(yearlyExpense)}</p>
                    <p><strong>Total Tabungan (Bersih):</strong> ${formatRupiah(yearlyNetSavings)}</p>
                    <p><strong>Saldo Akhir Tahun:</strong> ${formatRupiah(yearlyIncome - yearlyExpense - yearlyNetSavings)}</p>
                    <p><strong>Rasio Tabungan:</strong> ${yearlyIncome > 0 ? Math.round((yearlyNetSavings / yearlyIncome) * 100) : 0}%</p>
                </div>
                
                <p style="margin-top: 40px; font-size: 0.9rem; color: #666;">
                    Laporan dibuat pada: ${new Date().toLocaleDateString('id-ID')}
                </p>
                </body>
                </html>
            `;
            
            // Open print dialog
            const printWindow = window.open('', '_blank');
            printWindow.document.write(reportContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Backup data
        function backupData() {
            const data = {
                transactions: transactions,
                backupDate: new Date().toISOString(),
                appVersion: "1.0"
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup-keuangan-${new Date().toISOString().split('T')[0]}.json`;
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', exportFileDefaultName);
            link.click();
            
            alert(`Data berhasil di-backup: ${exportFileDefaultName}`);
        }
        
        // Restore data
        function restoreData() {
            const fileInput = document.getElementById('restore-file');
            
            if (!fileInput.files.length) {
                alert('Pilih file backup terlebih dahulu!');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!backupData.transactions || !Array.isArray(backupData.transactions)) {
                        throw new Error('Format file tidak valid.');
                    }
                    
                    if (!confirm(`Anda akan memulihkan ${backupData.transactions.length} transaksi. Lanjutkan?`)) {
                        return;
                    }
                    
                    transactions = backupData.transactions;
                    saveData();
                    
                    updateDashboard();
                    renderTransactions();
                    renderYearlySummary();
                    
                    document.getElementById('restore-modal').style.display = 'none';
                    fileInput.value = '';
                    
                    alert(`Data berhasil dipulihkan! ${transactions.length} transaksi dimuat.`);
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }
        
        // Export data
        function exportData() {
            backupData();
        }
        
        // Import data
        function importData() {
            document.getElementById('restore-modal').style.display = 'flex';
        }
        
        // Clear all data
        function clearAllData() {
            if (!confirm('Apakah Anda yakin ingin menghapus SEMUA data? Tindakan ini tidak dapat dibatalkan.')) {
                return;
            }
            
            transactions = [];
            saveData();
            updateDashboard();
            renderTransactions();
            renderYearlySummary();
            
            alert('Semua data telah dihapus.');
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('familyFinanceTransactions', JSON.stringify(transactions));
        }
        
        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('familyFinanceTransactions');
            if (savedData) {
                transactions = JSON.parse(savedData);
            }
        }
        
        // Format Rupiah currency
        function formatRupiah(amount) {
            return 'Rp ' + amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }
        
        // Toggle theme (dark/light mode)
        function toggleTheme() {
            const body = document.body;
            const isDark = body.classList.contains('dark-theme');
            
            if (isDark) {
                body.classList.remove('dark-theme');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
            }
        }
        
        // Initialize theme
        loadTheme();
    </script>
</body>
</html>